<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í†µí•© ìˆ˜ì§‘ ì›¹ ë„êµ¬ (ìˆ˜ì • ì™„ë£Œ)</title>
    <!-- Tailwind CSS CDN ë¡œë“œ -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* 'Inter' í°íŠ¸ ì‚¬ìš© */
        body { font-family: 'Inter', sans-serif; }
    </style>
</head>
<body class="bg-gray-50 flex items-center justify-center min-h-screen p-4">

    <!-- ë©”ì¸ ì• í”Œë¦¬ì¼€ì´ì…˜ ì»¨í…Œì´ë„ˆ -->
    <div class="w-full max-w-2xl bg-white p-8 rounded-xl shadow-2xl border border-gray-100 grid grid-cols-1 lg:grid-cols-2 gap-8">

        <!-- ì„¹ì…˜ 1: ë§í¬ ìˆ˜ì§‘ê¸° (ì¶œì²˜ í•„ë“œ ì œê±° ì™„ë£Œ) -->
        <div class="space-y-4 border-r lg:pr-8 pr-0 lg:border-gray-200 border-none">
            <h2 class="text-xl font-bold text-gray-800 border-l-4 border-blue-500 pl-2">ğŸ”— ë§í¬ ìˆ˜ì§‘ (ìë™ ë¶„ë¥˜)</h2>
            
            <!-- API ì„¤ì • ê²½ê³  -->
            <div id="settings-warning-link" class="bg-amber-50 border-l-4 border-amber-500 text-amber-700 p-3 rounded-md text-sm" role="alert">
                <p>ğŸš¨ **LINK ì„¤ì • ì™„ë£Œ!**</p>
            </div>

            <form id="link-form" class="space-y-3">
                <div>
                    <label for="link-url" class="block text-sm font-medium text-gray-700 mb-1">ë§í¬ (URL)</label>
                    <input type="url" id="link-url" placeholder="https://www.youtube.com/..." required
                           class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-blue-500">
                </div>
                
                <!-- ì¶œì²˜ ì…ë ¥ë€ ì œê±°ë¨ -->

                <button type="submit" id="submit-button-link"
                        class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg transition duration-300">
                    <span id="button-text-link">ë§í¬ ì €ì¥ ë° ë¶„ë¥˜</span>
                    <div id="loading-spinner-link" class="hidden w-4 h-4 border-2 border-t-2 border-white rounded-full animate-spin ml-2 inline-block"></div>
                </button>
            </form>
            <div id="result-message-link" class="p-3 rounded-lg hidden text-sm"></div>
        </div>


        <!-- ì„¹ì…˜ 2: ë‹¨ì–´/ë¬¸ì¥ ìˆ˜ì§‘ê¸° (ì¶œì²˜ í•„ë“œ ìœ ì§€) -->
        <div class="space-y-4">
            <h2 class="text-xl font-bold text-gray-800 border-l-4 border-purple-500 pl-2">ğŸ“š ë‹¨ì–´/ë¬¸ì¥ ìˆ˜ì§‘</h2>
            
            <!-- API ì„¤ì • ê²½ê³  -->
            <div id="settings-warning-word" class="bg-amber-50 border-l-4 border-amber-500 text-amber-700 p-3 rounded-md text-sm" role="alert">
                <p>ğŸš¨ **WORD ì„¤ì • ì™„ë£Œ!**</p>
            </div>

            <form id="word-form" class="space-y-3">
                <div>
                    <label for="word-text" class="block text-sm font-medium text-gray-700 mb-1">ë‹¨ì–´ ë˜ëŠ” ë¬¸ì¥ ì…ë ¥</label>
                    <textarea id="word-text" placeholder="ì˜¤ëŠ˜ ë°°ìš´ ìƒˆë¡œìš´ ë‹¨ì–´ë‚˜ ë¬¸ì¥ì„ ì…ë ¥í•˜ì„¸ìš”." required rows="4"
                              class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-purple-500"></textarea>
                </div>
                
                <div>
                    <label for="source-word" class="block text-sm font-medium text-gray-700 mb-1">ì¶œì²˜ (ê¸°ë¡)</label>
                    <input type="text" id="source-word" placeholder="ì±… í˜ì´ì§€, ë¯¸ë””ì–´ ì´ë¦„ ë“±"
                           class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-purple-500">
                </div>

                <button type="submit" id="submit-button-word"
                        class="w-full bg-purple-600 hover:bg-purple-700 text-white font-bold py-2 px-4 rounded-lg transition duration-300">
                    <span id="button-text-word">ë‹¨ì–´/ë¬¸ì¥ Sheetsì— ì €ì¥</span>
                    <div id="loading-spinner-word" class="hidden w-4 h-4 border-2 border-t-2 border-white rounded-full animate-spin ml-2 inline-block"></div>
                </button>
            </form>
            <div id="result-message-word" class="p-3 rounded-lg hidden text-sm"></div>
        </div>

    </div>

    <script>
        // =======================================================================
        // ğŸš¨ğŸš¨ğŸš¨ ID ì„¤ì • ì™„ë£Œ (ì‚¬ìš©ì ì…ë ¥ ê°’ ë°˜ì˜) ğŸš¨ğŸš¨ğŸš¨
        // =======================================================================
        
        // --- 1. ë§í¬ ìˆ˜ì§‘ê¸° ì„¤ì • (3ê°œ í•„ë“œ: ë‚ ì§œ, ë§í¬, ì¹´í…Œê³ ë¦¬) ---
        const LINK_FORM_ID = '1FAIpQLScputjj5czPcnqrOEflF2YgSd_AXyc48H3obkDeSAZAzq5QSA'; 
        const LINK_FIELD_MAP = {
            DATE: 'entry.1500600991',       
            LINK: 'entry.644613965',       
            CATEGORY: 'entry.1171711441',
            DLUT_TOKEN: 'dlut'          
        }; 

        // --- 2. ë‹¨ì–´/ë¬¸ì¥ ìˆ˜ì§‘ê¸° ì„¤ì • (3ê°œ í•„ë“œ: ë‚ ì§œ, ë‹¨ì–´/ë¬¸ì¥, ì¶œì²˜) ---
        const WORD_FORM_ID = '1FAIpQLSeOLceiq2ssLfCYb2rKKYXyJwUX9-moPc3QdnpdiVt4-iVNYw'; 
        const WORD_FIELD_MAP = {
            DATE: 'entry.2021585367',       
            WORD_SENTENCE: 'entry.711110369', 
            SOURCE: 'entry.1350015625', 
            DLUT_TOKEN: 'dlut'          
        }; 

        // =======================================================================
        // (ìˆ˜ì • ë) ì•„ë˜ ì½”ë“œëŠ” ë³€ê²½í•˜ì§€ ë§ˆì„¸ìš”.
        // =======================================================================
        
        // UI ELEMENTS (Link Form)
        const formLink = document.getElementById('link-form');
        const urlInput = document.getElementById('link-url');
        const submitButtonLink = document.getElementById('submit-button-link');
        const buttonTextLink = document.getElementById('button-text-link');
        const loadingSpinnerLink = document.getElementById('loading-spinner-link');
        const resultMessageLink = document.getElementById('result-message-link');
        const settingsWarningLink = document.getElementById('settings-warning-link');

        // UI ELEMENTS (Word Form)
        const formWord = document.getElementById('word-form');
        const wordTextInput = document.getElementById('word-text');
        const sourceWordInput = document.getElementById('source-word'); 
        const submitButtonWord = document.getElementById('submit-button-word');
        const buttonTextWord = document.getElementById('button-text-word');
        const loadingSpinnerWord = document.getElementById('loading-spinner-word');
        const resultMessageWord = document.getElementById('result-message-word');
        const settingsWarningWord = document.getElementById('settings-warning-word');


        // Function to check configuration status
        // IDê°€ 'YOUR_'ë¡œ ì‹œì‘í•˜ì§€ ì•Šìœ¼ë©´ ì„¤ì • ì™„ë£Œë¡œ ê°„ì£¼í•©ë‹ˆë‹¤.
        const isLinkConfigured = !LINK_FORM_ID.includes('YOUR_') && !LINK_FIELD_MAP.DATE.includes('YOUR_');
        const isWordConfigured = !WORD_FORM_ID.includes('YOUR_') && !WORD_FIELD_MAP.DATE.includes('YOUR_');

        if (isLinkConfigured) settingsWarningLink.style.display = 'none';
        if (isWordConfigured) settingsWarningWord.style.display = 'none';


        // Function to get platform category (LINK Form)
        function getPlatformCategory(url) {
            try {
                const hostname = new URL(url).hostname.toLowerCase();
                if (hostname.includes('youtube') || hostname.includes('youtu.be')) return 'ìœ íŠœë¸Œ (YouTube)';
                if (hostname.includes('twitter') || hostname.includes('x.com')) return 'ì†Œì…œ ë¯¸ë””ì–´ (X/Twitter)';
                if (hostname.includes('instagram')) return 'ì†Œì…œ ë¯¸ë””ì–´ (Instagram)';
                if (hostname.includes('facebook')) return 'ì†Œì…œ ë¯¸ë””ì–´ (Facebook)';
                if (hostname.includes('naver') && hostname.includes('blog')) return 'ë¸”ë¡œê·¸ (ë„¤ì´ë²„)';
                if (hostname.includes('tistory') || hostname.includes('medium')) return 'ë¸”ë¡œê·¸ (ê¸°íƒ€)';
                return 'ì¼ë°˜ ì›¹ì‚¬ì´íŠ¸';
            } catch { return 'íŒŒì‹± ì˜¤ë¥˜'; }
        }

        // Generic submit function for Forms
        async function submitViaForm(formId, fieldMap, dataArray) {
            const formUrl = \`https://docs.google.com/forms/d/e/\${formId}/formResponse\`; 
            const formData = new FormData();
            
            // Map data to field IDs dynamically
            const fieldKeys = Object.keys(fieldMap).filter(k => k !== 'DLUT_TOKEN'); // Exclude dlut from data mapping
            
            for (let i = 0; i < fieldKeys.length; i++) {
                // dataArrayì˜ í¬ê¸°ëŠ” fieldKeysì˜ í¬ê¸°ì™€ ì¼ì¹˜í•´ì•¼ í•©ë‹ˆë‹¤.
                formData.append(fieldMap[fieldKeys[i]], dataArray[i]);
            }
            
            // Add security token
            formData.append(fieldMap.DLUT_TOKEN, ''); 

            try {
                // Note: No error handling for 40x or 50x status codes in no-cors mode, only network errors
                await fetch(formUrl, { method: 'POST', mode: 'no-cors', body: formData });
                return { success: true };
            } catch (error) {
                // Network error will be caught here
                throw new Error('ì „ì†¡ ì‹¤íŒ¨');
            }
        }

        // Function to set loading state
        function setButtonLoading(type, loading) {
            if (type === 'link') {
                submitButtonLink.disabled = loading;
                buttonTextLink.textContent = loading ? 'ì €ì¥ ì¤‘...' : 'ë§í¬ ì €ì¥ ë° ë¶„ë¥˜';
                loadingSpinnerLink.classList.toggle('hidden', !loading);
            } else if (type === 'word') {
                submitButtonWord.disabled = loading;
                buttonTextWord.textContent = loading ? 'ì €ì¥ ì¤‘...' : 'ë‹¨ì–´/ë¬¸ì¥ Sheetsì— ì €ì¥';
                loadingSpinnerWord.classList.toggle('hidden', !loading);
            }
        }

        // Function to display results
        function displayMessage(type, success, msg) {
            const msgEl = type === 'link' ? resultMessageLink : resultMessageWord;
            
            msgEl.textContent = msg;
            msgEl.className = success 
                ? 'p-3 rounded-lg bg-green-100 text-green-800 text-sm mt-4' 
                : 'p-3 rounded-lg bg-red-100 text-red-800 text-sm mt-4';
            msgEl.classList.remove('hidden');
        }


        // --- Event Listeners ---

        // 1. Link Form Submission
        formLink.addEventListener('submit', async (e) => {
            e.preventDefault();
            if (!isLinkConfigured) { return displayMessage('link', false, 'ğŸš¨ ë§í¬ ìˆ˜ì§‘ê¸° IDë¥¼ ë¨¼ì € ì„¤ì •í•´ì£¼ì„¸ìš”!'); }
            
            setButtonLoading('link', true);
            
            const link = urlInput.value.trim();
            const date = new Date().toISOString().slice(0, 10).replace(/-/g, '');
            const category = getPlatformCategory(link);

            try {
                // ë°ì´í„° ë°°ì—´: [ë‚ ì§œ, ë§í¬, ì¹´í…Œê³ ë¦¬] (3ê°œë§Œ ì „ì†¡)
                await submitViaForm(LINK_FORM_ID, LINK_FIELD_MAP, [date, link, category]);
                displayMessage('link', true, \`âœ… ì €ì¥ ì„±ê³µ! [\${category}]\`);
                urlInput.value = '';
            } catch (err) {
                displayMessage('link', false, 'âŒ ì €ì¥ ì‹¤íŒ¨ (Forms ì„¤ì •ì„ í™•ì¸í•˜ì„¸ìš”)');
            }
            setButtonLoading('link', false);
        });

        // 2. Word Form Submission
        formWord.addEventListener('submit', async (e) => {
            e.preventDefault();
            if (!isWordConfigured) { return displayMessage('word', false, 'ğŸš¨ ë‹¨ì–´ ìˆ˜ì§‘ê¸° IDë¥¼ ë¨¼ì € ì„¤ì •í•´ì£¼ì„¸ìš”!'); }
            
            setButtonLoading('word', true);
            
            const text = wordTextInput.value.trim();
            const source = sourceWordInput.value.trim(); // Get source
            const date = new Date().toISOString().slice(0, 10).replace(/-/g, '');

            if (!text) {
                setButtonLoading('word', false);
                return displayMessage('word', false, 'âš ï¸ ë‹¨ì–´/ë¬¸ì¥ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
            }

            try {
                // ë°ì´í„° ë°°ì—´: [ë‚ ì§œ, ë‹¨ì–´/ë¬¸ì¥, ì¶œì²˜] (3ê°œ)
                await submitViaForm(WORD_FORM_ID, WORD_FIELD_MAP, [date, text, source]);
                displayMessage('word', true, \`âœ… ì €ì¥ ì„±ê³µ!\`);
                wordTextInput.value = '';
                sourceWordInput.value = ''; // Clear source
            } catch (err) {
                displayMessage('word', false, 'âŒ ì €ì¥ ì‹¤íŒ¨ (Forms ì„¤ì •ì„ í™•ì¸í•˜ì„¸ìš”)');
            }
            setButtonLoading('word', false);
        });
    </script>
</body>
</html>
