<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Google Sheets ì—°ë™ ë§í¬ ìˆ˜ì§‘ê¸°</title>
    <!-- Tailwind CSS CDN ë¡œë“œ -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* 'Inter' í°íŠ¸ ì‚¬ìš© */
        body { font-family: 'Inter', sans-serif; }
    </style>
</head>
<body class="bg-gray-50 flex items-center justify-center min-h-screen p-4">

    <!-- ë©”ì¸ ì• í”Œë¦¬ì¼€ì´ì…˜ ì»¨í…Œì´ë„ˆ -->
    <div class="w-full max-w-lg bg-white p-8 rounded-xl shadow-2xl border border-gray-100">
        <h1 class="text-3xl font-extrabold text-gray-900 mb-2 text-center">
            ğŸ”— ë§í¬ ìˆ˜ì§‘ ì›¹ ë„êµ¬
        </h1>
        <p class="text-sm text-gray-500 mb-8 text-center">
            ë§í¬ë¥¼ ì…ë ¥í•˜ë©´ ì¹´í…Œê³ ë¦¬ ìë™ ë¶„ë¥˜ í›„ Google Sheetsì— ì €ì¥ë©ë‹ˆë‹¤.
        </p>

        <!-- API ì„¤ì • ê²½ê³  -->
        <div id="settings-warning" class="bg-red-50 border-l-4 border-red-500 text-red-700 p-4 mb-6 rounded-md" role="alert">
            <p class="font-bold">âœ… ìµœì¢… ìˆ˜ì • ì ìš©ë¨</p>
            <p class="text-sm">Formsì˜ ìˆ¨ê²¨ì§„ í•„ìˆ˜ í† í°(dlut)ê¹Œì§€ í¬í•¨í•˜ì—¬ ìµœì¢… ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤. ì´ì œ ì‘ë™í•´ì•¼ í•©ë‹ˆë‹¤!</p>
        </div>

        <form id="link-form">
            <div class="mb-4">
                <label for="link-url" class="block text-sm font-medium text-gray-700 mb-2">ë§í¬ (URL)</label>
                <input type="url" id="link-url" placeholder="https://www.youtube.com/..." required
                       class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 transition duration-150 shadow-sm">
            </div>

            <button type="submit" id="submit-button"
                    class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-4 rounded-lg transition duration-300 ease-in-out shadow-md hover:shadow-lg focus:outline-none focus:ring-4 focus:ring-blue-300 flex items-center justify-center disabled:opacity-50">
                <span id="button-text">ë§í¬ ì €ì¥ ë° ë¶„ë¥˜</span>
                <div id="loading-spinner" class="hidden w-5 h-5 border-2 border-t-2 border-white rounded-full animate-spin ml-2"></div>
            </button>
        </form>

        <!-- ê²°ê³¼ ë©”ì‹œì§€ ì˜ì—­ -->
        <div id="result-message" class="mt-6 p-4 rounded-lg hidden" role="status"></div>
    </div>

    <script>
        // =======================================================================
        // âœ… ìµœì¢… í™•ì¸: dlut í•„ë“œ ì¶”ê°€ ì ìš© ì™„ë£Œ
        // =======================================================================
        const FORM_ID = '1FAIpQLScputjj5czPcnqrOEflF2YgSd_AXyc48H3obkDeSAZAzq5QSA'; 

        const FIELD_MAP = {
            DATE: 'entry.1500600991',     
            LINK: 'entry.644613965',       
            CATEGORY: 'entry.1171711441',  
            // ğŸš¨ ìµœì¢… ì¶”ê°€: Formsì˜ ë‚´ë¶€ ë³´ì•ˆ í† í°ì„ ì²˜ë¦¬í•˜ëŠ” í•„ë“œ (ìˆ¨ê²¨ì§„ í•„ë“œ)
            DLUT_TOKEN: 'dlut' 
        }; 
        // =======================================================================

        const form = document.getElementById('link-form');
        const urlInput = document.getElementById('link-url');
        const resultMessage = document.getElementById('result-message');
        const submitButton = document.getElementById('submit-button');
        const buttonText = document.getElementById('button-text');
        const loadingSpinner = document.getElementById('loading-spinner');
        const settingsWarning = document.getElementById('settings-warning');
        
        // URLì„ ë¶„ì„í•˜ì—¬ í”Œë«í¼ ì¹´í…Œê³ ë¦¬ë¥¼ ê²°ì •í•˜ëŠ” í•¨ìˆ˜
        function getPlatformCategory(url) {
            try {
                const urlObj = new URL(url);
                const hostname = urlObj.hostname.toLowerCase();
                const path = urlObj.pathname.toLowerCase();

                if (!hostname) return 'ìœ íš¨í•˜ì§€ ì•Šì€ í˜•ì‹';

                if (hostname.includes('youtube.com') || hostname.includes('youtu.be')) {
                    return 'ìœ íŠœë¸Œ (YouTube)';
                } else if (hostname.includes('twitter.com') || hostname.includes('x.com')) {
                    return 'ì†Œì…œ ë¯¸ë””ì–´ (X/Twitter)';
                } else if (hostname.includes('instagram.com')) {
                    return 'ì†Œì…œ ë¯¸ë””ì–´ (Instagram)';
                } else if (hostname.includes('facebook.com') || hostname.includes('fb.com')) {
                    return 'ì†Œì…œ ë¯¸ë””ì–´ (Facebook)';
                } else if (hostname.includes('naver.com') && (hostname.includes('blog') || path.includes('blog'))) {
                    return 'ë¸”ë¡œê·¸ (ë„¤ì´ë²„)';
                } else if (hostname.includes('tistory.com') || hostname.includes('medium.com')) {
                    return 'ë¸”ë¡œê·¸ (ê¸°íƒ€)';
                } else if (hostname.includes('github.com') || hostname.includes('gitlab.com')) {
                    return 'ì½”ë“œ/ì €ì¥ì†Œ (Code/Repo)';
                } else if (hostname.includes('news') || hostname.includes('daily') || hostname.includes('press') || hostname.includes('media')) {
                    return 'ë‰´ìŠ¤/ì–¸ë¡  (News/Media)';
                } else if (hostname.includes('reddit.com') || hostname.includes('cafe.naver.com')) {
                    return 'ì»¤ë®¤ë‹ˆí‹°/í¬ëŸ¼ (Community/Forum)';
                } else {
                    return 'ì¼ë°˜ ì›¹ì‚¬ì´íŠ¸ (Generic Web)';
                }
            } catch (e) {
                return 'íŒŒì‹± ì˜¤ë¥˜';
            }
        }

        // Google Formsë¥¼ í†µí•´ ë°ì´í„°ë¥¼ ì œì¶œí•˜ëŠ” í•¨ìˆ˜ (dlut í¬í•¨ 4ê°œ í•„ë“œ ì „ì†¡)
        async function submitViaForm(date, link, category) {
            const formUrl = `https://docs.google.com/forms/d/e/${FORM_ID}/formResponse`; 
            
            const formData = new FormData();
            formData.append(FIELD_MAP.DATE, date);
            formData.append(FIELD_MAP.LINK, link);
            formData.append(FIELD_MAP.CATEGORY, category);
            // dlut í•„ë“œë¥¼ ë¹ˆ ê°’ìœ¼ë¡œ ì¶”ê°€ (Forms ìœ íš¨ì„± ê²€ì‚¬ ìš°íšŒ ì‹œë„)
            formData.append(FIELD_MAP.DLUT_TOKEN, ''); 

            for (let attempt = 0; attempt < 4; attempt++) {
                try {
                    const response = await fetch(formUrl, {
                        method: 'POST',
                        mode: 'no-cors',
                        body: formData
                    });
                    return { success: true, category };
                    
                } catch (error) {
                    if (attempt === 3) {
                        throw new Error(`Google Forms ì œì¶œ ì‹¤íŒ¨: ${error.message}`);
                    }
                    const delay = Math.pow(2, attempt) * 1000 + Math.random() * 1000;
                    await new Promise(resolve => setTimeout(resolve, delay));
                }
            }
        }

        // ê²°ê³¼ ë©”ì‹œì§€ë¥¼ UIì— í‘œì‹œí•˜ëŠ” í•¨ìˆ˜
        function displayMessage(isSuccess, message) {
            resultMessage.textContent = message;
            resultMessage.classList.remove('hidden', 'bg-red-100', 'bg-green-100', 'text-red-800', 'text-green-800');
            if (isSuccess) {
                resultMessage.classList.add('bg-green-100', 'text-green-800');
                urlInput.value = ''; 
            } else {
                resultMessage.classList.add('bg-red-100', 'text-red-800');
            }
        }
        
        // ë²„íŠ¼ ë¡œë”© ìƒíƒœ ê´€ë¦¬ í•¨ìˆ˜
        function setButtonLoading(isLoading) {
            submitButton.disabled = isLoading;
            buttonText.textContent = isLoading ? 'ì €ì¥ ì¤‘...' : 'ë§í¬ ì €ì¥ ë° ë¶„ë¥˜';
            loadingSpinner.classList.toggle('hidden', !isLoading);
        }

        // í¼ ì œì¶œ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬
        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            // ì„¤ì • í™•ì¸: ì´ ë‹¨ê³„ì—ì„œëŠ” ì´ë¯¸ IDê°€ ì •í™•í•˜ë‹¤ê³  ê°€ì •í•©ë‹ˆë‹¤.
            if (FORM_ID.includes('YOUR_')) {
                displayMessage(false, 'ğŸš¨ Google Forms ì„¤ì •ì´ ì™„ë£Œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ì½”ë“œì˜ FORM_IDë¥¼ ìˆ˜ì •í•´ ì£¼ì„¸ìš”.');
                return;
            }

            const linkUrl = urlInput.value.trim();
            if (!linkUrl.startsWith('http')) {
                displayMessage(false, 'âš ï¸ ìœ íš¨í•œ URL í˜•ì‹(http:// ë˜ëŠ” https://)ìœ¼ë¡œ ì…ë ¥í•´ ì£¼ì„¸ìš”.');
                return;
            }

            setButtonLoading(true);
            resultMessage.classList.add('hidden');

            const current_date = new Date().toISOString().slice(0, 10).replace(/-/g, ''); 
            const category = getPlatformCategory(linkUrl);

            try {
                const result = await submitViaForm(current_date, linkUrl, category);
                displayMessage(true, `âœ… ì„±ê³µ! ì¹´í…Œê³ ë¦¬: ${result.category} - Sheetsì— ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.`);
            } catch (error) {
                displayMessage(false, `âŒ ì €ì¥ ì‹¤íŒ¨: Forms ì„¤ì •(dlut í¬í•¨)ì„ ë‹¤ì‹œ í™•ì¸í•´ ì£¼ì„¸ìš”.`);
                console.error("Critical Save Error:", error);
            } finally {
                setButtonLoading(false);
            }
        });

        // ì´ˆê¸° ì„¤ì • ê²½ê³  í‘œì‹œ/ìˆ¨ê¹€
        const isConfigured = !FORM_ID.includes('YOUR_');
        if (isConfigured) {
            settingsWarning.classList.add('hidden');
        }
    </script>
</body>
</html>
